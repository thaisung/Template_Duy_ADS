<html lang="vi"><script src="chrome-extension://eppiocemhmnlbhjplcgkofciiegomcon/content/location/location.js" id="eppiocemhmnlbhjplcgkofciiegomcon"></script><script src="chrome-extension://eppiocemhmnlbhjplcgkofciiegomcon/libs/extend-native-history-api.js"></script><script src="chrome-extension://eppiocemhmnlbhjplcgkofciiegomcon/libs/requests.js"></script><head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lu Y√™u Video ‚Äì Trang th√¥ng tin / t·ªïng h·ª£p li√™n k·∫øt</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="/upload/website/icon.jpg">
    <link rel="apple-touch-icon" href="/upload/website/icon.jpg">
    
    <!-- Open Graph / Facebook / Zalo -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://viewfullmedia.com/">
    <meta property="og:title" id="og-title" content="Lu Y√™u Video ‚Äì Trang th√¥ng tin / t·ªïng h·ª£p li√™n k·∫øt">
    <meta property="og:description" id="og-description" content="Xem video mi·ªÖn ph√≠, t·ªïng h·ª£p c√°c b·ªô video hay nh·∫•t">
    <meta property="og:image" id="og-image" content="/upload/website/icon.jpg">
    
    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" id="twitter-title" content="Lu Y√™u Video ‚Äì Trang th√¥ng tin / t·ªïng h·ª£p li√™n k·∫øt">
    <meta name="twitter:description" id="twitter-description" content="Xem video mi·ªÖn ph√≠, t·ªïng h·ª£p c√°c b·ªô video hay nh·∫•t">
    <meta name="twitter:image" id="twitter-image" content="/upload/website/icon.jpg">
    <style>
        * { box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            text-align: center;
            background: #121212;
            color: white;
            padding: 15px;
            margin: 0;
        }

        /* === N·ªòI DUNG CH√çNH === */
        #mobile-content {
            display: block;
            max-width: 900px;
            margin: 0 auto;
        }

        /* === PLAYER 9:16 === */
        .player-container { 
            position: relative; 
            width: 100%;
            max-width: 480px;
            margin: 0 auto 20px;
            background: #000;
            aspect-ratio: 9/16;
            max-height: calc(100vh - 220px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.8);
            border-radius: 12px;
            overflow: hidden;
        }
        
        /* Responsive cho PC */
        @media (min-width: 768px) {
            .player-container {
                max-width: 600px;
            }
        }
        
        @media (min-width: 1024px) {
            .player-container {
                max-width: 720px;
            }
        }
        
        iframe { width: 100%; height: 100%; border: none; }
        
        /* === EXTERNAL VIDEO PLACEHOLDER (T·∫≠p 1 v·ªõi Fanpage link) === */
        #external-video-placeholder {
            position: relative;
            width: 100%;
            height: 100%;
            background: #1a1a1a;
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            border-radius: 12px;
            overflow: hidden;
        }
        #external-video-placeholder.active {
            display: flex;
        }
        #external-video-thumbnail {
            width: 100%;
            height: 100%;
            object-fit: cover;
            position: absolute;
            top: 0;
            left: 0;
            opacity: 0.7;
            display: block;
            z-index: 1;
        }
        #external-video-play-btn {
            position: relative;
            z-index: 10;
            width: 80px;
            height: 80px;
            background: rgba(238, 77, 45, 0.95);
            border-radius: 50%;
            display: flex !important;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            color: white;
            box-shadow: 0 8px 20px rgba(0,0,0,0.5);
            transition: transform 0.2s;
            cursor: pointer;
        }
        #external-video-play-btn:active {
            transform: scale(0.95);
        }
        #external-video-label {
            position: relative;
            z-index: 10;
            margin-top: 20px;
            color: white;
            font-size: 16px;
            font-weight: 500;
            text-align: center;
            padding: 0 20px;
            display: block !important;
        }
        
        /* === OVERLAY SHOPEE === */
        #overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5);
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            z-index: 99; cursor: pointer;
            padding: 20px;
        }
        .btn-shopee-main {
            background: linear-gradient(135deg, #ff5722 0%, #ee4d2d 100%);
            color: white; border: none; padding: 18px 35px;
            font-size: 18px; font-weight: bold; border-radius: 50px; cursor: pointer;
            box-shadow: 0 8px 15px rgba(238, 77, 45, 0.4);
            text-transform: uppercase; letter-spacing: 1px;
        }
        .text-support { color: #f1c40f; font-size: 16px; margin-bottom: 15px; font-weight: 500; }
        .text-note { color: #777; font-size: 13px; margin-top: 15px; line-height: 1.4; }

        /* === EPISODE LIST === */
        .episode-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(90px, 1fr));
            gap: 10px; padding: 15px;
            background: #1e1e1e; border-radius: 15px;
        }
        .ep-item {
            background: #333; color: #ccc; border: 1px solid #444;
            padding: 12px 5px; cursor: pointer; border-radius: 8px;
            font-weight: 500; font-size: 14px;
        }
        .ep-item.active { background: #ee4d2d; color: white; border-color: #ee4d2d; font-weight: bold; }
        .ep-item.uploading { background: #222; color: #555; border: 1px dashed #444; cursor: not-allowed; }

        /* === T√åM KI·∫æM === */
        .search-container { margin-bottom: 16px; text-align: left; }
        .search-title { font-size: 22px; font-weight: 600; margin-bottom: 6px; }
        .search-desc { font-size: 13px; color: #bbb; margin-bottom: 8px; }
        .search-input {
            width: 100%; padding: 10px 12px; border-radius: 8px;
            border: 1px solid #444; background: #1b1b1b; color: #eee; font-size: 14px;
        }
        .search-results {
            margin-top: 6px; max-height: 160px; overflow-y: auto;
            border-radius: 8px; border: 1px solid #333; background: #181818;
        }
        .search-result-item {
            padding: 8px 10px; font-size: 13px; cursor: pointer; border-bottom: 1px solid #222;
        }
        .search-result-item:last-child { border-bottom: none; }
        .search-result-item:hover { background: #262626; }

        /* === TOP PHIM (GRID LAYOUT - CU·ªòN D·ªåC) === */
        .top-section { margin-top: 18px; text-align: left; }
        .top-title { font-size: 17px; font-weight: 600; margin-bottom: 10px; }
        .top-grid {
            display: grid;
            gap: 10px;
            grid-template-columns: repeat(4, 1fr);
        }
        /* Responsive cho PC */
        @media (min-width: 600px) {
            .top-grid { grid-template-columns: repeat(5, 1fr); }
        }
        @media (min-width: 768px) {
            .top-grid { grid-template-columns: repeat(6, 1fr); }
        }
        @media (min-width: 900px) {
            .top-grid { grid-template-columns: repeat(7, 1fr); }
        }
        @media (min-width: 1024px) {
            .top-grid { grid-template-columns: repeat(8, 1fr); }
        }
        @media (min-width: 1200px) {
            .top-grid { grid-template-columns: repeat(9, 1fr); }
        }
        @media (min-width: 1400px) {
            .top-grid { grid-template-columns: repeat(10, 1fr); }
        }
        .top-card {
            width: 100%;
            background: #1a1a1a;
            border-radius: 8px;
            overflow: hidden;
            cursor: pointer;
            transition: transform 0.2s;
        }
        .top-card:hover { transform: scale(1.03); }
        .top-card-wrapper { position: relative; }
        .top-card-img {
            width: 100%;
            aspect-ratio: 3/4;
            object-fit: cover;
            background: #222;
            display: block;
        }
        .top-card-nopic {
            width: 100%;
            aspect-ratio: 3/4;
            background: linear-gradient(135deg, #2a2a2a 0%, #1a1a1a 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #555;
            font-size: 11px;
            font-weight: 500;
        }
        .top-card-rank {
            position: absolute;
            top: 4px; left: 4px;
            background: #ee4d2d;
            color: #fff;
            font-size: 10px;
            font-weight: bold;
            padding: 2px 6px;
            border-radius: 4px;
        }
        .top-card-name {
            padding: 5px 4px;
            font-size: 10px;
            color: #ccc;
            line-height: 1.3;
            text-align: center;
            height: 30px;
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
        }

        /* T√≥m t·∫Øt video */
        #film-summary {
            margin-top: 8px;
            margin-bottom: 12px;
            font-size: 14px;
            color: #ccc;
            line-height: 1.5;
            text-align: left;
            display: none;
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
        }
        #film-summary.expanded {
            display: block;
            overflow: visible;
            -webkit-line-clamp: unset;
            display: block;
        }
        #film-summary-toggle {
            display: none;
            font-size: 12px;
            color: #999;
            cursor: pointer;
            margin-top: -4px;
            margin-bottom: 8px;
            text-align: right;
        }
        #film-summary-toggle span {
            text-decoration: underline;
        }

        /* === BANNER CAROUSEL === */
        .banner-container {
            width: 100%;
            height: 200px;
            position: relative;
            margin: 16px 0;
            border-radius: 12px;
            overflow: hidden;
            background: #1a1a1a;
        }
        @media (min-width: 900px) {
            .banner-container {
                height: 500px;
                max-width: 100%;
            }
        }
        .banner-wrapper {
            display: flex;
            width: 100%;
            height: 100%;
            transition: transform 0.5s ease-in-out;
        }
        .banner-slide {
            min-width: 100%;
            height: 100%;
            position: relative;
        }
        .banner-slide img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .banner-prev, .banner-next {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(0,0,0,0.5);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 24px;
            z-index: 10;
            transition: background 0.3s;
        }
        .banner-prev:hover, .banner-next:hover {
            background: rgba(0,0,0,0.8);
        }
        .banner-prev { left: 10px; }
        .banner-next { right: 10px; }
        .banner-dots {
            position: absolute;
            bottom: 15px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 8px;
            z-index: 10;
        }
        .banner-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: rgba(255,255,255,0.5);
            cursor: pointer;
            transition: all 0.3s;
        }
        .banner-dot.active {
            background: #ee4d2d;
            width: 24px;
            border-radius: 4px;
        }

        /* === LINK BUTTONS === */
        .link-buttons { margin-top: 16px; display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; }
        .link-btn {
            padding: 8px 14px; border-radius: 999px; border: 1px solid #333;
            background: #1e1e1e; color: #f5f5f5; font-size: 13px;
            cursor: pointer; text-decoration: none; white-space: nowrap;
        }
        .link-btn:hover { background: #333; }
        .link-btn-primary { border-color: #ee4d2d; background: #ee4d2d; }
        .link-btn-primary:hover { background: #ff6a3a; }

        /* === DONATE BOX === */
        .donate-box {
            margin-top: 18px; padding: 12px 14px; background: #181818;
            border-radius: 10px; border: 1px solid #333; font-size: 13px; text-align: left;
        }
        .donate-text-title { font-weight: 600; color: #f1c40f; margin-bottom: 4px; }
        .donate-text-sub { color: #aaa; line-height: 1.4; }
        .donate-text-sub strong.stk { color: #ff6a3a; font-size: 15px; font-weight: bold; }

        /* === GENRE TABS === */
        .genre-section { margin-top: 18px; text-align: left; }
        .genre-tabs {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 12px;
        }
        .genre-tab {
            padding: 8px 16px;
            background: #1e1e1e;
            color: #ccc;
            border: 1px solid #333;
            border-radius: 20px;
            cursor: pointer;
            font-size: 13px;
            transition: all 0.3s;
        }
        .genre-tab:hover {
            background: #2a2a2a;
            border-color: #444;
        }
        .genre-tab.active {
            background: #ee4d2d;
            color: white;
            border-color: #ee4d2d;
        }
    </style>
<script bis_use="true" type="text/javascript" charset="utf-8" data-bis-config="[&quot;facebook.com/&quot;,&quot;twitter.com/&quot;,&quot;youtube-nocookie.com/embed/&quot;,&quot;//vk.com/&quot;,&quot;//www.vk.com/&quot;,&quot;linkedin.com/&quot;,&quot;//www.linkedin.com/&quot;,&quot;//instagram.com/&quot;,&quot;//www.instagram.com/&quot;,&quot;//www.google.com/recaptcha/api2/&quot;,&quot;//hangouts.google.com/webchat/&quot;,&quot;//www.google.com/calendar/&quot;,&quot;//www.google.com/maps/embed&quot;,&quot;spotify.com/&quot;,&quot;soundcloud.com/&quot;,&quot;//player.vimeo.com/&quot;,&quot;//disqus.com/&quot;,&quot;//tgwidget.com/&quot;,&quot;//js.driftt.com/&quot;,&quot;friends2follow.com&quot;,&quot;/widget&quot;,&quot;login&quot;,&quot;//video.bigmir.net/&quot;,&quot;blogger.com&quot;,&quot;//smartlock.google.com/&quot;,&quot;//keep.google.com/&quot;,&quot;/web.tolstoycomments.com/&quot;,&quot;moz-extension://&quot;,&quot;chrome-extension://&quot;,&quot;/auth/&quot;,&quot;//analytics.google.com/&quot;,&quot;adclarity.com&quot;,&quot;paddle.com/checkout&quot;,&quot;hcaptcha.com&quot;,&quot;recaptcha.net&quot;,&quot;2captcha.com&quot;,&quot;accounts.google.com&quot;,&quot;www.google.com/shopping/customerreviews&quot;,&quot;buy.tinypass.com&quot;,&quot;gstatic.com&quot;,&quot;secureir.ebaystatic.com&quot;,&quot;docs.google.com&quot;,&quot;contacts.google.com&quot;,&quot;github.com&quot;,&quot;mail.google.com&quot;,&quot;chat.google.com&quot;,&quot;audio.xpleer.com&quot;,&quot;keepa.com&quot;,&quot;static.xx.fbcdn.net&quot;,&quot;sas.selleramp.com&quot;,&quot;1plus1.video&quot;,&quot;console.googletagservices.com&quot;,&quot;//lnkd.demdex.net/&quot;,&quot;//radar.cedexis.com/&quot;,&quot;//li.protechts.net/&quot;,&quot;challenges.cloudflare.com/&quot;,&quot;ogs.google.com&quot;]" data-dynamic-id="c6d30c77-ae66-4646-9160-3460e3a9b073" src="chrome-extension://eppiocemhmnlbhjplcgkofciiegomcon/executors/traffic.js"></script></head>
<body __processed_8d53667c-2e70-4c1f-a90a-a4b2e16a5e10__="true" bis_register="W3sibWFzdGVyIjp0cnVlLCJleHRlbnNpb25JZCI6ImVwcGlvY2VtaG1ubGJoanBsY2drb2ZjaWllZ29tY29uIiwiYWRibG9ja2VyU3RhdHVzIjp7IkRJU1BMQVkiOiJlbmFibGVkIiwiRkFDRUJPT0siOiJlbmFibGVkIiwiVFdJVFRFUiI6ImVuYWJsZWQiLCJSRURESVQiOiJlbmFibGVkIiwiUElOVEVSRVNUIjoiZW5hYmxlZCIsIklOU1RBR1JBTSI6ImVuYWJsZWQiLCJUSUtUT0siOiJkaXNhYmxlZCIsIkxJTktFRElOIjoiZW5hYmxlZCIsIkNPTkZJRyI6ImRpc2FibGVkIn0sInZlcnNpb24iOiIyLjAuMzgiLCJzY29yZSI6MjAwMzgwfV0=">

<!-- ========== N·ªòI DUNG CH√çNH ========== -->
<div id="mobile-content" bis_skin_checked="1" style="display: block;">
    <!-- T√åM KI·∫æM -->
    <div class="search-container" bis_skin_checked="1">
        <div class="search-title" bis_skin_checked="1">T√¨m video :</div>
        <div class="search-desc" bis_skin_checked="1">
            Nh·∫≠p <strong>t√™n video</strong> gi·ªëng nh∆∞ m√¥ t·∫£ tr√™n Fanpage/TikTok m√† b·∫°n ƒë√£ xem. V√≠ d·ª•: <em>"Ch√†ng Trai Xuy√™n Kh√¥ng X√¢y D·ª±ng ƒê·∫ø Ch·∫ø B·ªã V·ª£ C·∫Øm S·ª´ng C∆∞·ªõp C√¥ng V√† C√°i K·∫øt L√†m Ch·ªìng N·ªØ ƒê·∫ø"</em>
        </div>
        <div class="search-desc" style="margin-top: 6px;" bis_skin_checked="1">
            L∆∞u √Ω: Mu·ªën xem ·ªïn ƒë·ªãnh/ƒë·∫ßy ƒë·ªß, h√£y m·ªü b·∫±ng <strong>Safari (iOS)</strong> ho·∫∑c <strong>tr√¨nh duy·ªát Chrome (Android)</strong>.
        </div>
        <form action="" method="get">
            <input id="search-input" name="s" class="search-input" type="text" placeholder="Nh·∫≠p T√™n Video ƒë·ªÉ t√¨m..." autocomplete="off">
        </form>
        <div id="search-results" class="search-results" style="display:none;" bis_skin_checked="1"></div>
    </div>

    <!-- BANNER CAROUSEL -->
    <div id="banner-carousel" class="banner-container" style="display:none;" bis_skin_checked="1">
        <div class="banner-wrapper" bis_skin_checked="1"></div>
        <div class="banner-dots" bis_skin_checked="1"></div>
        <button class="banner-prev">‚Äπ</button>
        <button class="banner-next">‚Ä∫</button>
    </div>

    <!-- DONATE MESSAGE -->
    <div class="donate-box" bis_skin_checked="1">
        <div class="donate-text-sub" id="donate-content" bis_skin_checked="1">
            V√¨ v·∫•n ƒë·ªÅ b·∫£n quy·ªÅn n√™n th·ªùi l∆∞·ª£ng c√°c t·∫≠p video kh√° ng·∫Øn, mong m·ªçi ng∆∞·ªùi th√¥ng c·∫£m cho team üôá<br><br>
            To√†n b·ªô video tr√™n viewfullmedia.com ƒë·ªÅu l√† mi·ªÖn ph√≠, ch√∫ng m√¨nh ch·ªâ ƒë·∫∑t click shopee ƒë·ªÉ duy tr√¨ ho·∫°t ƒë·ªông. C·∫£m ∆°n c√°c b·∫°n ƒë√£ ·ªßng h·ªô v√† h√£y chia s·∫ª n·∫øu th·∫•y hay nha!!!
        </div>
    </div>

    <!-- PHIM ƒê·ªÄ XU·∫§T (TOP) -->
    <div id="top-section" class="top-section" style="display: block;" bis_skin_checked="1">
        <div class="top-title" bis_skin_checked="1">üì∫ Video ƒë·ªÅ xu·∫•t</div>
        <div id="top-grid" class="top-grid" bis_skin_checked="1">
            {% for i in Product %}
            <a class="top-card" href="{% url 'home' slug=i.Slug %}" bis_skin_checked="1">
                <div class="top-card-wrapper" bis_skin_checked="1">
                    <img class="top-card-img" src="{{ i.Avatar.url }}" alt="{{ i.Title }}">
                    <div class="top-card-rank" bis_skin_checked="1">TOP {{ forloop.counter }}</div>
                </div>
                <div class="top-card-name" bis_skin_checked="1">{{ i.Title }}</div>
            </a>
            {% endfor %}
        </div>
    </div>

    <!-- PHIM THEO TH·ªÇ LO·∫†I -->
    <div id="genre-section" class="genre-section" style="display:none;" bis_skin_checked="1">
        <div class="top-title" bis_skin_checked="1">üé¨ Video theo th·ªÉ lo·∫°i</div>
        <div id="genre-tabs" class="genre-tabs" bis_skin_checked="1"></div>
        <div id="genre-grid" class="top-grid" bis_skin_checked="1"></div>
    </div>

    <!-- N√öT C·ªòNG ƒê·ªíNG -->
    <div class="link-buttons" bis_skin_checked="1">
        <a id="fanpage-link" class="link-btn" href="https://web.facebook.com/share/g/17952doBBb/?mibextid=wwXIfr&_rdc=1&_rdr" target="_blank" rel="noopener noreferrer">Tham gia nh√≥m Fanpage</a>
        <a id="youtube-link" class="link-btn" href="" target="_blank" rel="noopener noreferrer">Theo d√µi &amp; nh·∫•n chu√¥ng YTB</a>
    </div>

    <!-- L∆ØU √ù (DISCLAIMER) -->
    <div id="disclaimer-home" style="margin-top: 14px; font-size: 12px; color: #888; text-align: left;" bis_skin_checked="1">
        <strong>L∆∞u √Ω:</strong> Ph·∫ßn d·ªãch + l·ªìng ti·∫øng (AI) t·∫°o b·ªüi team Lu Y√™u Video. Video g·ªëc l·∫•y t·ª´ c√°c ngu·ªìn ph·ªï bi·∫øn tr√™n Internet. N·∫øu b·∫°n cho r·∫±ng quy·ªÅn l·ª£i b·ªã ·∫£nh h∆∞·ªüng, vui l√≤ng li√™n h·ªá ƒë·ªÉ g·ª°. Fanpage: <a href="" target="_blank" rel="noopener noreferrer" style="color: #ee4d2d; text-decoration: underline;"><strong>DCT Media</strong></a>
    </div>

    <!-- KHU V·ª∞C XEM PHIM -->
    <div id="movie-section" style="display:none; margin-top: 16px;" bis_skin_checked="1">
        <h2 id="film-title" style="font-size: 20px;">T·∫≠p 1 - T√™n Video C·ªßa B·∫°n</h2>
        <div id="film-summary" bis_skin_checked="1"></div>
        <div id="film-summary-toggle" bis_skin_checked="1"><span>Xem th√™m</span></div>

        <div class="player-container" bis_skin_checked="1">
            <div id="overlay" style="display: none !important;" bis_skin_checked="1"></div>
            <div id="external-video-placeholder" onclick="openExternalVideo()" bis_skin_checked="1">
                <img id="external-video-thumbnail" src="" alt="Video thumbnail" style="display: none;" onerror="this.style.display='none'">
                <div id="external-video-play-btn" style="display: flex !important;" bis_skin_checked="1">‚ñ∂</div>
                <div id="external-video-label" style="display: block !important;" bis_skin_checked="1">Xem tr√™n Fanpage</div>
            </div>
            <iframe id="video-player" src="" allow="fullscreen" allowfullscreen=""></iframe>
        </div>

        <div id="episode-list" class="episode-list" bis_skin_checked="1"></div>

        <div style="margin-top: 14px; font-size: 12px; color: #888; text-align: left;" bis_skin_checked="1">
            <strong>L∆∞u √Ω:</strong> Ph·∫ßn d·ªãch + l·ªìng ti·∫øng (AI) t·∫°o b·ªüi team Lu Y√™u Video. Video g·ªëc l·∫•y t·ª´ c√°c ngu·ªìn ph·ªï bi·∫øn tr√™n Internet. N·∫øu b·∫°n cho r·∫±ng quy·ªÅn l·ª£i b·ªã ·∫£nh h∆∞·ªüng, vui l√≤ng li√™n h·ªá ƒë·ªÉ g·ª°. Fanpage: <a href="https://www.facebook.com/luyeuvideo.dramashorts/" target="_blank" rel="noopener noreferrer" style="color: #ee4d2d; text-decoration: underline;"><strong>Lu Y√™u Video</strong></a>
        </div>
    </div>
</div>

<script>
// ========== KI·ªÇM TRA THI·∫æT B·ªä - ƒê√É C·∫¨P NH·∫¨T ========== 
function checkDevice() {
    var mobileContent = document.getElementById('mobile-content');
    
    // Lu√¥n hi·ªÉn th·ªã n·ªôi dung cho c·∫£ PC v√† mobile
    if (mobileContent) mobileContent.style.display = 'block';
}

// Ch·∫°y ngay v√† ch·∫°y l·∫°i khi load xong
checkDevice();
window.addEventListener('load', checkDevice);
window.addEventListener('resize', checkDevice);

// ========== LOAD CONFIG ========== 
var SITE_CONFIG_URL = "https://raw.githubusercontent.com/puvo2307-svg/luyeuvideo-site/main/site-config.json";
var siteConfig = null;

function loadSiteConfig() {
    fetch(SITE_CONFIG_URL)
        .then(function(res) {
            if (!res.ok) {
                throw new Error("Kh√¥ng th·ªÉ load config: " + res.status);
            }
            return res.json();
        })
        .then(function(config) {
            siteConfig = config;
            updateDonateInfo();
            updateSocialLinks();
            updateMetaTags();
        })
        .catch(function(e) {
            console.error("L·ªói load config:", e);
            useDefaultConfig();
        });
}

function useDefaultConfig() {
    siteConfig = {
        donate: {
            title: "·ª¶ng h·ªô duy tr√¨ k√™nh",
            bank: "MB Bank",
            accountName: "LE THI TUYET HOA",
            accountNumber: "9323082004",
            note: "Ung ho Lu Yeu Video",
            message: "C·∫£m ∆°n b·∫°n ƒë√£ ·ªßng h·ªô ƒë·ªÉ k√™nh c√≥ th·ªÉ duy tr√¨ ho·∫°t ƒë·ªông l√¢u d√†i."
        },
        social: {
            fanpage: "https://www.facebook.com/groups/luyeuvideo",
            youtube: "https://youtube.com/channel/UCb35SXg3vJeYP5povmGHA1A?sub_confirmation=1",
            fanpageContact: "https://www.facebook.com/luyeuvideo.dramashorts/",
            youtubeRedirect: "https://youtube.com/channel/UCb35SXg3vJeYP5povmGHA1A?sub_confirmation=1"
        }
    };
    updateDonateInfo();
    updateSocialLinks();
}

function updateDonateInfo() {
    if (!siteConfig || !siteConfig.donate) return;
    // C·∫≠p nh·∫≠t th√¥ng tin donate n·∫øu c·∫ßn
}

function updateSocialLinks() {
    if (!siteConfig || !siteConfig.social) return;
    var s = siteConfig.social;
    
    var fanpageLink = document.getElementById('fanpage-link');
    if (fanpageLink && s.fanpage) {
        fanpageLink.href = s.fanpage;
    }
    
    var youtubeLink = document.getElementById('youtube-link');
    if (youtubeLink && s.youtube) {
        youtubeLink.href = s.youtube;
    }
}

function updateMetaTags() {
    if (!siteConfig || !siteConfig.meta) return;
    var m = siteConfig.meta;
    
    if (m.title) {
        document.title = m.title;
        var ogTitle = document.getElementById('og-title');
        if (ogTitle) ogTitle.content = m.title;
        var twitterTitle = document.getElementById('twitter-title');
        if (twitterTitle) twitterTitle.content = m.title;
    }
    
    if (m.description) {
        var ogDesc = document.getElementById('og-description');
        if (ogDesc) ogDesc.content = m.description;
        var twitterDesc = document.getElementById('twitter-description');
        if (twitterDesc) twitterDesc.content = m.description;
    }
    
    if (m.image) {
        var ogImage = document.getElementById('og-image');
        if (ogImage) ogImage.content = m.image;
        var twitterImage = document.getElementById('twitter-image');
        if (twitterImage) twitterImage.content = m.image;
    }
}

// ========== LOAD D·ªÆ LI·ªÜU T·ª™ JSON ========== 
var movieIndex = {};
var banners = [];
var currentEpisode = null;
var pendingOpen = null;

function normalizeText(str) {
    return String(str || "")
        .toLowerCase()
        .normalize('NFD')
        .replace(/[\u0300-\u036f]/g, '')
        .replace(/ƒë/g, 'd').replace(/ƒê/g, 'D')
        .replace(/\s+/g, ' ')
        .trim();
}

function loadMoviesFromJSON() {
    var jsonUrl = "https://raw.githubusercontent.com/puvo2307-svg/luyeuvideo-site/main/movies.json?t=" + Date.now();
    fetch(jsonUrl, { cache: 'no-store' })
        .then(function(res) {
            if (!res.ok) {
                throw new Error("Kh√¥ng th·ªÉ load JSON: " + res.status);
            }
            return res.json();
        })
        .then(function(data) {
            movieIndex = {};
            banners = [];

            var movies = data.movies || [];
            banners = data.banners || [];

            movies.forEach(function(movie) {
                var filmId = movie.name || "";
                if (!filmId) return;

                var displayName = movie.vietName || movie.name || "";
                
                movieIndex[filmId] = {
                    episodes: movie.episodes || [],
                    topRank: movie.top || null,
                    poster: movie.poster || "",
                    displayName: displayName,
                    summary: movie.summary || "",
                    allowPC: true, // ƒê√É C·∫¨P NH·∫¨T: Lu√¥n cho ph√©p xem tr√™n PC
                    year: movie.year || "",
                    genre: (movie.genre && movie.genre.trim()) ? movie.genre.trim() : "",
                    country: movie.country || ""
                };

                movieIndex[filmId].episodes.sort(function(a, b) {
                    return (a.ep || 0) - (b.ep || 0);
                });
            });

            renderTopMovies();
            initGenreTabs();
            if (banners.length > 0) {
                renderBanners();
            }

            if (pendingOpen && pendingOpen.id && movieIndex[pendingOpen.id]) {
                loadMovieById(pendingOpen.id, { preferredEp: pendingOpen.ep, fromHash: true });
            }
        })
        .catch(function(e) {
            console.error("L·ªói load JSON:", e);
        });
}

// ========== HELPER: CHECK DEVICE - ƒê√É C·∫¨P NH·∫¨T ========== 
function isMobileDevice() {
    // Lu√¥n tr·∫£ v·ªÅ true ƒë·ªÉ t·∫•t c·∫£ video ƒë·ªÅu hi·ªÉn th·ªã
    return true;
}

// ========== HI·ªÇN TH·ªä TOP PHIM ========== 
{% comment %} function renderTopMovies() {
    var section = document.getElementById('top-section');
    var gridEl = document.getElementById('top-grid');

    if (gridEl) gridEl.innerHTML = "";

    var entries = [];
    Object.keys(movieIndex).forEach(function(name) {
        var data = movieIndex[name];
        if (data.topRank != null) {
            entries.push({ id: name, name: data.displayName || name, rank: data.topRank, poster: data.poster });
        }
    });
    entries.sort(function(a, b) { return a.rank - b.rank; });

    if (!entries.length) {
        if (section) section.style.display = "none";
        return;
    }

    function createCard(item, clickable) {
        var card = document.createElement('div');
        card.className = 'top-card';
        if (clickable) {
            card.onclick = function() { loadMovieById(item.id); };
        }

        var wrapper = document.createElement('div');
        wrapper.className = 'top-card-wrapper';

        if (item.poster && item.poster.trim()) {
            var img = document.createElement('img');
            img.className = 'top-card-img';
            img.src = item.poster;
            img.alt = item.name;
            img.onerror = function() {
                var nopic = document.createElement('div');
                nopic.className = 'top-card-nopic';
                nopic.textContent = 'No Pic';
                this.parentNode.replaceChild(nopic, this);
            };
            wrapper.appendChild(img);
        } else {
            var nopic = document.createElement('div');
            nopic.className = 'top-card-nopic';
            nopic.textContent = 'No Pic';
            wrapper.appendChild(nopic);
        }

        var rankBadge = document.createElement('div');
        rankBadge.className = 'top-card-rank';
        rankBadge.textContent = 'TOP ' + item.rank;
        wrapper.appendChild(rankBadge);

        var nameDiv = document.createElement('div');
        nameDiv.className = 'top-card-name';
        nameDiv.textContent = item.name;

        card.appendChild(wrapper);
        card.appendChild(nameDiv);
        return card;
    }

    entries.forEach(function(item) {
        if (gridEl) {
            gridEl.appendChild(createCard(item, true));
        }
    });

    if (section) section.style.display = "block";
} {% endcomment %}

// ========== PHIM THEO TH·ªÇ LO·∫†I ========== 
var currentGenreTab = null;
var availableGenres = [];

function initGenreTabs() {
    var genreSet = new Set();
    Object.keys(movieIndex).forEach(function(id) {
        var data = movieIndex[id];
        if (data.genre && data.genre.trim()) {
            genreSet.add(data.genre.trim());
        }
    });
    
    availableGenres = Array.from(genreSet).sort();
    
    var tabsContainer = document.getElementById('genre-tabs');
    var section = document.getElementById('genre-section');
    
    if (!tabsContainer || !section) return;
    
    tabsContainer.innerHTML = "";
    
    if (availableGenres.length === 0) {
        section.style.display = "none";
        return;
    }
    
    availableGenres.forEach(function(genre, index) {
        var tab = document.createElement('button');
        tab.className = 'genre-tab' + (index === 0 ? ' active' : '');
        tab.setAttribute('data-genre', genre);
        tab.textContent = genre;
        tab.onclick = function() { switchGenreTab(genre); };
        tabsContainer.appendChild(tab);
    });
    
    if (availableGenres.length > 0) {
        currentGenreTab = availableGenres[0];
        section.style.display = "block";
        renderGenreMovies(currentGenreTab);
    }
}

function switchGenreTab(genre) {
    currentGenreTab = genre;
    
    var tabs = document.querySelectorAll('.genre-tab');
    tabs.forEach(function(tab) {
        if (tab.getAttribute('data-genre') === genre) {
            tab.classList.add('active');
        } else {
            tab.classList.remove('active');
        }
    });
    
    renderGenreMovies(genre);
}

function renderGenreMovies(genre) {
    var gridEl = document.getElementById('genre-grid');
    if (!gridEl) return;
    
    gridEl.innerHTML = "";
    
    var entries = [];
    
    Object.keys(movieIndex).forEach(function(id) {
        var data = movieIndex[id];
        
        if (data.genre && data.genre.trim() === genre) {
            var latestUploadDate = null;
            if (data.episodes && data.episodes.length > 0) {
                data.episodes.forEach(function(ep) {
                    if (ep.uploadDate && ep.uploadDate.trim()) {
                        var epDate = ep.uploadDate.trim();
                        if (!latestUploadDate || epDate > latestUploadDate) {
                            latestUploadDate = epDate;
                        }
                    }
                });
            }
            
            entries.push({
                id: id,
                name: data.displayName || id,
                poster: data.poster,
                uploadDate: latestUploadDate || '1970-01-01'
            });
        }
    });
    
    entries.sort(function(a, b) {
        return b.uploadDate.localeCompare(a.uploadDate);
    });
    
    if (!entries.length) {
        gridEl.innerHTML = '<div style="text-align: center; color: #888; padding: 20px;">Ch∆∞a c√≥ video th·ªÉ lo·∫°i "' + genre + '"</div>';
        var section = document.getElementById('genre-section');
        if (section) section.style.display = "block";
        return;
    }
    
    function createGenreCard(item) {
        var card = document.createElement('div');
        card.className = 'top-card';
        card.onclick = function() { loadMovieById(item.id); };

        var wrapper = document.createElement('div');
        wrapper.className = 'top-card-wrapper';

        if (item.poster && item.poster.trim()) {
            var img = document.createElement('img');
            img.className = 'top-card-img';
            img.src = item.poster;
            img.alt = item.name;
            img.onerror = function() {
                var nopic = document.createElement('div');
                nopic.className = 'top-card-nopic';
                nopic.textContent = 'No Pic';
                this.parentNode.replaceChild(nopic, this);
            };
            wrapper.appendChild(img);
        } else {
            var nopic = document.createElement('div');
            nopic.className = 'top-card-nopic';
            nopic.textContent = 'No Pic';
            wrapper.appendChild(nopic);
        }

        var nameDiv = document.createElement('div');
        nameDiv.className = 'top-card-name';
        nameDiv.textContent = item.name;

        card.appendChild(wrapper);
        card.appendChild(nameDiv);
        return card;
    }
    
    entries.forEach(function(item) {
        gridEl.appendChild(createGenreCard(item));
    });
    
    var section = document.getElementById('genre-section');
    if (section) {
        section.style.display = "block";
    }
}

// ========== BANNER CAROUSEL ========== 
var currentBannerIndex = 0;
var bannerInterval = null;

function renderBanners() {
    var container = document.getElementById('banner-carousel');
    
    var validBanners = banners.filter(function(bannerItem) {
        var bannerUrl = typeof bannerItem === 'object' ? bannerItem.url : bannerItem;
        return bannerUrl && typeof bannerUrl === 'string' && bannerUrl.trim().length > 0 && bannerUrl.startsWith('http');
    });
    
    if (validBanners.length === 0) {
        if (container) container.style.display = "none";
        return;
    }
    
    if (container) {
        var wrapper = container.querySelector('.banner-wrapper');
        var dots = container.querySelector('.banner-dots');
        
        if (wrapper && dots) {
            wrapper.innerHTML = "";
            dots.innerHTML = "";
            
            validBanners.forEach(function(bannerItem, index) {
                var bannerUrl = typeof bannerItem === 'object' ? bannerItem.url : bannerItem;
                var movieId = typeof bannerItem === 'object' ? bannerItem.movieId : null;
                
                var slide = document.createElement('div');
                slide.className = 'banner-slide';
                slide.style.transform = `translateX(${index * 100}%)`;
                slide.style.background = '#1a1a1a';
                
                if (movieId && movieIndex[movieId]) {
                    slide.style.cursor = 'pointer';
                    slide.onclick = function() {
                        loadMovieById(movieId);
                    };
                }
                
                var img = document.createElement('img');
                img.src = bannerUrl;
                img.alt = `Banner ${index + 1}`;
                img.style.width = '100%';
                img.style.height = '100%';
                img.style.objectFit = 'cover';
                img.onerror = function() {
                    this.style.display = 'none';
                    slide.style.background = 'linear-gradient(135deg, #2a2a2a 0%, #1a1a1a 100%)';
                    slide.innerHTML = '<div style="display: flex; align-items: center; justify-content: center; height: 100%; color: #555; font-size: 14px;">Banner kh√¥ng t·∫£i ƒë∆∞·ª£c</div>';
                };
                
                slide.appendChild(img);
                wrapper.appendChild(slide);
                
                var dot = document.createElement('div');
                dot.className = 'banner-dot' + (index === 0 ? ' active' : '');
                dot.onclick = function() { goToBanner(index); };
                dots.appendChild(dot);
            });
            
            container.style.display = "block";
            updateBannerPosition();
            startAutoSlide();
        }
    }
    
    currentBannerIndex = 0;
}

function goToBanner(index) {
    currentBannerIndex = index;
    updateBannerPosition();
    resetAutoSlide();
}

function nextBanner() {
    var container = document.getElementById('banner-carousel');
    if (!container) return;
    var slides = container.querySelectorAll('.banner-slide');
    var totalBanners = slides ? slides.length : banners.length;
    currentBannerIndex = (currentBannerIndex + 1) % totalBanners;
    updateBannerPosition();
}

function prevBanner() {
    var container = document.getElementById('banner-carousel');
    if (!container) return;
    var slides = container.querySelectorAll('.banner-slide');
    var totalBanners = slides ? slides.length : banners.length;
    currentBannerIndex = (currentBannerIndex - 1 + totalBanners) % totalBanners;
    updateBannerPosition();
}

function updateBannerPosition() {
    var container = document.getElementById('banner-carousel');
    if (!container) return;
    
    var wrapper = container.querySelector('.banner-wrapper');
    if (!wrapper) return;
    
    wrapper.style.transform = `translateX(-${currentBannerIndex * 100}%)`;
    
    var dots = container.querySelectorAll('.banner-dot');
    dots.forEach(function(dot, index) {
        dot.classList.toggle('active', index === currentBannerIndex);
    });
}

function startAutoSlide() {
    stopAutoSlide();
    var container = document.getElementById('banner-carousel');
    if (!container) return;
    var slides = container.querySelectorAll('.banner-slide');
    var totalBanners = slides ? slides.length : 0;
    if (totalBanners <= 1) return;
    bannerInterval = setInterval(function() {
        nextBanner();
    }, 5000);
}

function stopAutoSlide() {
    if (bannerInterval) {
        clearInterval(bannerInterval);
        bannerInterval = null;
    }
}

function resetAutoSlide() {
    stopAutoSlide();
    startAutoSlide();
}

document.addEventListener('DOMContentLoaded', function() {
    var bannerContainer = document.getElementById('banner-carousel');
    if (bannerContainer) {
        bannerContainer.addEventListener('mouseenter', stopAutoSlide);
        bannerContainer.addEventListener('mouseleave', startAutoSlide);
        
        var nextBtn = bannerContainer.querySelector('.banner-next');
        var prevBtn = bannerContainer.querySelector('.banner-prev');
        
        if (nextBtn) {
            nextBtn.addEventListener('click', function() {
                nextBanner();
                resetAutoSlide();
            });
        }
        if (prevBtn) {
            prevBtn.addEventListener('click', function() {
                prevBanner();
                resetAutoSlide();
            });
        }
        
        var touchStartX = 0;
        var touchEndX = 0;
        
        bannerContainer.addEventListener('touchstart', function(e) {
            touchStartX = e.changedTouches[0].screenX;
            stopAutoSlide();
        });
        
        bannerContainer.addEventListener('touchend', function(e) {
            touchEndX = e.changedTouches[0].screenX;
            if (touchEndX < touchStartX - 50) {
                nextBanner();
            }
            if (touchEndX > touchStartX + 50) {
                prevBanner();
            }
            startAutoSlide();
        });
    }
});

// ========== T√åM KI·∫æM ========== 
{% comment %} function renderSearchResults(keyword) {
    var box = document.getElementById('search-results');
    if (!box) return;

    var qNorm = normalizeText(keyword);
    box.innerHTML = "";
    if (!qNorm) {
        box.style.display = "none";
        return;
    }

    var names = Object.keys(movieIndex)
        .map(function(id) { return { id: id, name: (movieIndex[id].displayName || id) }; })
        .filter(function(item) {
            return normalizeText(item.name).includes(qNorm);
        });

    if (!names.length) {
        box.innerHTML = '<div class="search-result-item">Kh√¥ng t√¨m th·∫•y video ph√π h·ª£p.</div>';
        box.style.display = "block";
        return;
    }

    names.slice(0, 30).forEach(function(item) {
        var div = document.createElement('div');
        div.className = 'search-result-item';
        div.textContent = item.name;
        div.onclick = function() {
            box.style.display = "none";
            document.getElementById('search-input').value = item.name;
            loadMovieById(item.id);
        };
        box.appendChild(div);
    });
    box.style.display = "block";
} {% endcomment %}

// ========== LOAD PHIM - ƒê√É C·∫¨P NH·∫¨T ========== 
function getFirstEpisodeObj(episodes, preferredEp) {
    if (!episodes || !episodes.length) return null;
    if (preferredEp === 'FULL' || preferredEp === 'full' || String(preferredEp).toUpperCase() === 'FULL') {
        for (var i = 0; i < episodes.length; i++) {
            if (episodes[i].ep === 'FULL' || episodes[i].ep === 'full') return episodes[i];
        }
    }
    var epNum = Number(preferredEp);
    if (!isNaN(epNum)) {
        for (var i = 0; i < episodes.length; i++) {
            if (Number(episodes[i].ep) === epNum) return episodes[i];
        }
    }
    return episodes[0];
}

function setUrlState(id, ep) {
    try {
        var safeId = encodeURIComponent(String(id || ""));
        var safeEp = encodeURIComponent(String(ep || ""));
        window.location.hash = "m=" + safeId + "&e=" + safeEp;
    } catch (e) {
        // ignore
    }
}

function parseUrlState() {
    var h = (window.location.hash || "").replace(/^#/, "").trim();
    if (!h) return null;
    var out = {};
    h.split("&").forEach(function(part) {
        var kv = part.split("=");
        if (kv.length < 2) return;
        var k = decodeURIComponent(kv[0] || "").trim();
        var v = decodeURIComponent(kv.slice(1).join("=") || "").trim();
        out[k] = v;
    });
    if (out.m) {
        return { id: out.m, ep: out.e ? Number(out.e) : null };
    }
    return null;
}

function loadMovieById(id, opts) {
    opts = opts || {};
    var data = movieIndex[id];
    if (!data || !data.episodes.length) return;
    
    // ƒê√É X√ìA: Kh√¥ng c√≤n ki·ªÉm tra allowPC n·ªØa

    var episodes = data.episodes;
    var epList = document.getElementById('episode-list');
    if (!epList) return;

    epList.innerHTML = "";

    var myShopeeLink = "https://s.shopee.vn/9pXNbUiEFE";
    var lastShopeeLink = myShopeeLink;
    episodes.forEach(function(item, index) {
        if (item.shopeeLink && item.shopeeLink.trim()) {
            lastShopeeLink = item.shopeeLink.trim();
        } else if (item.ep > 1) {
            item.shopeeLink = lastShopeeLink;
        }
        if (item.ep === 1) {
            item.shopeeLink = null;
        }
    });

    episodes.forEach(function(item) {
        var div = document.createElement('div');
        div.className = 'ep-item';
        if (item.ep === 'FULL' || item.ep === 'full') {
            div.textContent = "FULL";
        } else {
            div.textContent = "T·∫≠p " + item.ep;
        }
        div.onclick = function() {
            var clickedDiv = this;
            var epNum = Number(item.ep);
            var isEp2Plus = !isNaN(epNum) && epNum > 1;
            var hasShopeeLink = item.shopeeLink && item.shopeeLink.trim() && item.shopeeLink.trim() !== 'null';
            
            var embedUrlStr = item.embedUrl ? String(item.embedUrl).trim() : '';
            var isDailymotionEmbed = embedUrlStr && (
                embedUrlStr.includes('geo.dailymotion.com') || 
                embedUrlStr.includes('dailymotion.com/embed') ||
                embedUrlStr.includes('dailymotion.com/player.html')
            );
            
            var videoUrlStr = item.videoUrl ? String(item.videoUrl).trim() : '';
            var isExternalLink = videoUrlStr && (
                videoUrlStr.includes('facebook.com') || 
                videoUrlStr.includes('fb.com') || 
                videoUrlStr.includes('/reel/') ||
                videoUrlStr.includes('youtube.com') || 
                videoUrlStr.includes('youtu.be')
            );
            
            if (isEp2Plus && isDailymotionEmbed && hasShopeeLink) {
                var shopeeUrl = item.shopeeLink.trim();
                window.open(shopeeUrl, '_blank');
                
                var youtubeRedirectUrl = (siteConfig && siteConfig.social && siteConfig.social.youtubeRedirect) 
                    ? siteConfig.social.youtubeRedirect 
                    : "https://youtube.com/channel/UCb35SXg3vJeYP5povmGHA1A?sub_confirmation=1";
                setTimeout(function() {
                    window.open(youtubeRedirectUrl, '_blank');
                }, 300);
                
                changeEpisode(item.ep, item.embedUrl, data.displayName || id, clickedDiv, id, item.shopeeLink, item.videoUrl);
                return;
            } else if (isEp2Plus && hasShopeeLink && !isDailymotionEmbed) {
                var shopeeUrl = item.shopeeLink.trim();
                window.open(shopeeUrl, '_blank');
                changeEpisode(item.ep, item.embedUrl, data.displayName || id, clickedDiv, id, item.shopeeLink, item.videoUrl);
            } else {
                changeEpisode(item.ep, item.embedUrl, data.displayName || id, clickedDiv, id, item.shopeeLink, item.videoUrl);
            }
        };
        epList.appendChild(div);
    });

    var first = getFirstEpisodeObj(episodes, opts.preferredEp);
    var movieSection = document.getElementById('movie-section');
    if (movieSection) {
        movieSection.style.display = 'block';
        var disclaimerHome = document.getElementById('disclaimer-home');
        if (disclaimerHome) disclaimerHome.style.display = 'none';
    }

    var summaryEl = document.getElementById('film-summary');
    var summaryToggle = document.getElementById('film-summary-toggle');
    if (summaryEl && summaryToggle) {
        var summaryText = (data.summary || "").trim();
        if (summaryText) {
            summaryEl.textContent = summaryText;
            summaryEl.classList.remove('expanded');
            summaryEl.style.display = '-webkit-box';

            summaryToggle.style.display = 'block';
            summaryToggle.dataset.expanded = 'false';
            summaryToggle.querySelector('span').textContent = 'Xem th√™m';

            summaryToggle.onclick = function () {
                var isExpanded = summaryToggle.dataset.expanded === 'true';
                if (isExpanded) {
                    summaryEl.classList.remove('expanded');
                    summaryEl.style.display = '-webkit-box';
                    summaryToggle.querySelector('span').textContent = 'Xem th√™m';
                    summaryToggle.dataset.expanded = 'false';
                } else {
                    summaryEl.classList.add('expanded');
                    summaryToggle.querySelector('span').textContent = 'Thu g·ªçn';
                    summaryToggle.dataset.expanded = 'true';
                }
            };
        } else {
            summaryEl.style.display = 'none';
            summaryToggle.style.display = 'none';
        }
    }

    movieSection.scrollIntoView({ behavior: 'smooth' });

    var activeEl = null;
    for (var i = 0; i < epList.children.length; i++) {
        var txt = epList.children[i].textContent || "";
        var firstEpText = (first.ep === 'FULL' || first.ep === 'full') ? 'FULL' : ("t·∫≠p" + String(first.ep));
        if (txt.replace(/\s+/g, '').toLowerCase() === firstEpText.replace(/\s+/g, '').toLowerCase()) {
            activeEl = epList.children[i];
            break;
        }
    }
    changeEpisode(first.ep, first.embedUrl, data.displayName || id, activeEl || epList.firstChild, id, first.shopeeLink, first.videoUrl);

    if (!opts.fromHash) {
        setUrlState(id, first.ep);
    }
}

document.addEventListener('DOMContentLoaded', function() {
    loadSiteConfig();
    
    var input = document.getElementById('search-input');
    if (input) {
        input.addEventListener('input', function() { renderSearchResults(input.value); });
    }
    pendingOpen = parseUrlState();
    loadMoviesFromJSON();
});

// ========== SHOPEE & PLAYER ========== 
var myShopeeLink = "https://s.shopee.vn/9pXNbUiEFE";
var currentShopeeLink = myShopeeLink;
var currentExternalVideoUrl = null;

function openExternalVideo() {
    if (currentExternalVideoUrl) {
        var shopeeLink = currentShopeeLink || myShopeeLink;
        
        if (shopeeLink && shopeeLink.trim() && shopeeLink.trim() !== 'null' && shopeeLink.trim() !== 'undefined' && shopeeLink.trim() !== '') {
            window.open(shopeeLink.trim(), "_blank");
            setTimeout(function() {
                window.open(currentExternalVideoUrl, "_blank");
            }, 500);
        } else {
            window.open(currentExternalVideoUrl, "_blank");
        }
    }
}

function changeEpisode(epNum, source, filmNameOverride, clickedEl, movieId, shopeeLink, videoUrl) {
    var overlay = document.getElementById('overlay');
    var player = document.getElementById('video-player');
    var placeholder = document.getElementById('external-video-placeholder');
    var placeholderThumb = document.getElementById('external-video-thumbnail');
    
    if (epNum === 'FULL' || epNum === 'full' || String(epNum).toUpperCase() === 'FULL') {
        currentEpisode = 'FULL';
    } else {
        currentEpisode = Number(epNum);
    }
    
    var videoUrlStr = videoUrl ? String(videoUrl).trim() : '';
    var embedUrlStr = source ? String(source).trim() : '';
    
    if (!videoUrlStr && embedUrlStr) {
        if (embedUrlStr.includes('facebook.com') || embedUrlStr.includes('fb.com') || embedUrlStr.includes('/reel/') || embedUrlStr.includes('youtube.com') || embedUrlStr.includes('youtu.be')) {
            videoUrlStr = embedUrlStr;
        }
    }
    
    var isDailymotionEmbed = embedUrlStr && (
        embedUrlStr.includes('geo.dailymotion.com') || 
        embedUrlStr.includes('dailymotion.com/embed') ||
        embedUrlStr.includes('dailymotion.com/player.html')
    );
    
    var shouldUseExternalLink = false;
    if (videoUrlStr && videoUrlStr.length > 0 && videoUrlStr.startsWith("http")) {
        if (!isDailymotionEmbed) {
            shouldUseExternalLink = true;
        } else {
            videoUrlStr = '';
        }
    }
    
    if (shouldUseExternalLink) {
        currentShopeeLink = (shopeeLink && shopeeLink.trim() && shopeeLink.trim() !== 'null') ? shopeeLink.trim() : myShopeeLink;
    } else if (isDailymotionEmbed) {
        if (currentEpisode === 1 || currentEpisode === 'FULL') {
            currentShopeeLink = null;
        } else {
            currentShopeeLink = (shopeeLink && shopeeLink.trim() && shopeeLink.trim() !== 'null') ? shopeeLink.trim() : myShopeeLink;
        }
    } else {
        currentShopeeLink = null;
    }
    
    if (overlay) {
        overlay.style.display = 'none';
    }
    
    if (shouldUseExternalLink && videoUrlStr && videoUrlStr.length > 0 && videoUrlStr.startsWith("http")) {
        currentExternalVideoUrl = videoUrlStr;
        
        if (player) player.style.display = 'none';
        if (placeholder) {
            placeholder.classList.add('active');
            
            var playBtn = document.getElementById('external-video-play-btn');
            var label = document.getElementById('external-video-label');
            if (playBtn) {
                playBtn.style.display = 'flex';
                playBtn.style.visibility = 'visible';
                playBtn.style.opacity = '1';
            }
            if (label) {
                if (currentEpisode === 1) {
                    if (videoUrlStr.includes('facebook.com') || videoUrlStr.includes('fb.com')) {
                        label.textContent = 'Xem tr√™n Fanpage';
                    } else if (videoUrlStr.includes('youtube.com') || videoUrlStr.includes('youtu.be')) {
                        label.textContent = 'Xem tr√™n YouTube';
                    } else {
                        label.textContent = 'Xem video';
                    }
                } else if (currentEpisode === 'FULL') {
                    label.textContent = 'üõí M·ªü Shopee & Xem FULL';
                } else {
                    if (videoUrlStr.includes('facebook.com') || videoUrlStr.includes('fb.com')) {
                        label.textContent = 'üõí M·ªü Shopee & Xem tr√™n Fanpage';
                    } else if (videoUrlStr.includes('youtube.com') || videoUrlStr.includes('youtu.be')) {
                        label.textContent = 'üõí M·ªü Shopee & Xem tr√™n YouTube';
                    } else {
                        label.textContent = 'üõí M·ªü Shopee & Xem video';
                    }
                }
                label.style.display = 'block';
                label.style.visibility = 'visible';
                label.style.opacity = '1';
            }
            
            if (movieId && movieIndex[movieId] && movieIndex[movieId].poster) {
                var posterUrl = movieIndex[movieId].poster.trim();
                if (posterUrl) {
                    placeholderThumb.src = posterUrl;
                    placeholderThumb.style.display = 'block';
                    placeholderThumb.onerror = function() {
                        this.style.display = 'none';
                    };
                } else {
                    placeholderThumb.style.display = 'none';
                }
            } else {
                placeholderThumb.style.display = 'none';
            }
        }
    } else {
        currentExternalVideoUrl = null;
        if (placeholder) placeholder.classList.remove('active');
        
        if (isDailymotionEmbed && embedUrlStr) {
            if (player) {
                player.style.display = 'block';
                var src = String(embedUrlStr);
                if (!src.includes('autoplay=')) {
                    src += (src.includes('?') ? '&' : '?') + 'autoplay=1&mute=0';
                }
                player.src = src;
            }
        } else {
            if (player) {
                player.style.display = 'none';
            }
        }
    }

    var displayTitle;
    if (epNum === 'FULL' || epNum === 'full' || String(epNum).toUpperCase() === 'FULL') {
        displayTitle = "FULL";
    } else {
        displayTitle = "T·∫≠p " + epNum;
    }
    var filmName = filmNameOverride || "T√™n Video";
    document.getElementById('film-title').innerText = displayTitle + " - " + filmName;

    var eps = document.getElementsByClassName('ep-item');
    for (var i = 0; i < eps.length; i++) { eps[i].classList.remove('active'); }
    if (clickedEl) clickedEl.classList.add('active');

    if (movieId) {
        setUrlState(movieId, currentEpisode);
    }
}
</script>

<script src="/static/django-browser-reload/reload-listener.js" data-worker-script-path="/static/django-browser-reload/reload-worker.js" data-events-path="/__reload__/events/" defer=""></script>
</body></html>